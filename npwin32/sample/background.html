<html>
<head>
<script>
function foo()
{
	try{
		var plugin = document.getElementById("p");
		// import functions
		var GetDiskFreeSpace = plugin.import( "kernel32.dll", "GetDiskFreeSpaceW", "WPPPP", "B" );
		var GetWindowsDirectory = plugin.import( "kernel32.dll", "GetWindowsDirectoryW", "WN", "N" );
		var MessageBox = plugin.import( "user32.dll", "MessageBoxW", "NWWN", "N" );
		var EnumWindows = plugin.import( "User32.dll", "EnumWindows", "KN", "B" );  
		var r = "";

		// example of retrieving string
		var buf = new Array( 257 ).join( " " );// space * 256
		if( GetWindowsDirectory ){
			GetWindowsDirectory.call( buf, buf.length );
			r = "Windows directory:'" + GetWindowsDirectory.arg( 0 ) + "'\n";
		}

		// example of retrieving integer
		if( GetDiskFreeSpace ){
			var SectorsPerCluster = 0, BytesPerSector = 0, NumberOfFreeClusters = 0, TotalNumberOfClusters = 0;
			if( GetDiskFreeSpace.call( "C:\\", SectorsPerCluster, BytesPerSector, NumberOfFreeClusters, TotalNumberOfClusters ) ){
				r += "SectorsPerCluster:" + GetDiskFreeSpace.arg( 1 ) + "\nBytesPerSector:" + GetDiskFreeSpace.arg( 2 ) +
					"\nNumberOfFreeClusters:" + GetDiskFreeSpace.arg( 3 ) + "\nTotalNumberOfClusters:" + GetDiskFreeSpace.arg( 4 );
			};
		}

		// you can also skip "call" 
		if( MessageBox ){
			MessageBox( 0, r, "Chrome", 0 );
		}

		/* TODO:
		// using callback function
		var callback = plugin.callback( function( hwnd, lparam ){ alert( "hwnd=" + hwnd ); return false;}, "NN", "B" );
		if( EnumWindows ){
			EnumWindows( callback, 0 );
		}
		*/
	}
	catch(e ){
		alert( e );
	}
}

</script>
</head>
<body>
	<embed type="application/x-win32api-dynamic-call" id="p" hidden="true" />
</body>
</html>

